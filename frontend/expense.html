<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
</head>
<body>
    <form action="#" onsubmit="getExpenses(event)" method="POST">
        <label for="expenseAmt" class="form-label">Choose Expense Amount</label>
        <input type="number" id="expenseAmt" class="form-control">
        <label for="description" class="form-label">Enter Expense Description</label>
        <input type="string" id="description" class="form-control">
        <label for="category" class="form-label">Choose a Category</label>
        <select id="category" class="form-select">
            <option value="fuel">Fuel</option>
            <option value="food">Food</option>
            <option value="electricity">Electricity</option>
            <option value="movie">Movie</option>
        </select>
        <button class="btn" type="submit">Add Expense</button>
    </form>

    <ul id="listOfExpenses"></ul>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>

    <script>
        function getExpenses(event) {
            event.preventDefault();
            // check this, used name, not sure if its id
            const expenseAmt = event.target.expenseAmt.value;
            const description = event.target.description.value;
            const category = event.target.category.value;
            const obj = {
                expenseAmt,
                description,
                category
            };
            axios.post("http://localhost:3000/expenses/post-expenses", obj)
            .then((response) => {
                displayExpenses(response.data.expenses);
            })
            .catch((err) => {
                document.body.innerHTML = document.body.innerHTML + "<h4> Something went wrong </h4>"
                console.log(err)
            })
        }

        window.addEventListener("DOMContentLoaded", () => {
            axios.get("http://localhost:3000/expenses/get-expenses")
            .then((response) => {
                for(var i = 0; i < response.data.expenses.length; i++) {
                    displayExpenses(response.data.expenses[i]);
                }
            })
            .catch((error) => {
                console.log(error)
            })
        })

        function displayExpenses(obj) {
            const parentDets = document.getElementById('listOfExpenses')
            const childDets = document.createElement('li')
            // These values that are taken are taken from the backend, so use same names as used to define schema-->
            childDets.textContent = obj.expenseAmount + '-' + obj.description + '-' + obj.category
            const delBtn = document.createElement('input');
            delBtn.type = 'button';
            delBtn.value = 'Delete Expense';
            delBtn.onclick = () => {
                parentDets.removeChild(childDets)
                axios.delete(`http://localhost:3000/expenses/delete-expenses/${obj.id}`)
                .then(response => {
                    // displayData(response.data);
                    console.log(response);
                })
                .catch(err => {
                    console.log(err);
                })
            }
            const editBtn = document.createElement('input');
            editBtn.type = 'button'
            editBtn.value = 'Edit Expense';
            editBtn.onclick = () => {

                // METHOD USING GET AND DELETE
                parentDets.removeChild(childDets)
                axios.get(`http://localhost:3000/expenses/get-expenses/${obj.id}`)
                .then((response) => {
                    const amount = response.data.expenses.expenseAmount;
                    const desc = response.data.expenses.description;
                    const category = response.data.expenses.category;

                    document.getElementById('expenseAmt').value = amount
                    document.getElementById('description').value = desc;
                    document.getElementById('category').value = category;

                    axios.delete(`http://localhost:3000/expenses/delete-expenses/${obj.id}`)
                    .then(response => {
                        // displayData(response.data);
                        displayExpenses(response);
                        console.log(response);
                    })
                    .catch(err => {
                        console.log(err);
                    })
                    // parentDets.removeChild(childDets)
                })
                .catch(err => {
                    console.log(err);
                })

                // UNCOMMENT FOR USING PUT:
                // axios.put(`http://localhost:3000/expenses/edit-expenses/${obj.id}`)
                // .then((response) => {
                //     // let obj = {
                //     //     expenseAmount: expenseAmount,
                //     //     description: description,
                //     //     category: category,
                //     //     id: obj.id
                //     // }
                //     console.log(response);
                //     // document.getElementById('listOfExpenses').removeChild(document.getElementById(obj.id))
                //     displayExpenses(response.data.expenses);
                // })
                // .catch((err) => {
                //     document.body.innerHTML = document.body.innerHTML + "<h4> Something went wrong </h4>"
                //     console.log(err)
                // })
                // parentDets.removeChild(childDets)
                // document.getElementById('expenseAmt').value = obj.expenseAmount;
                // document.getElementById('description').value = obj.description;
                // document.getElementById('category').value = obj.category;
            }
            childDets.appendChild(delBtn);
            childDets.appendChild(editBtn);
            parentDets.appendChild(childDets);
        }
    </script>
</body>
</html>

